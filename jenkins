pipeline{
    agent any
    environment {
        BUILD_TOOL="Maven"
        TESTING_TOOL="BrowserStack"
        ANALYSIS_TOOL="Jenkins own plugin"
        SECURITY_TOOL="Spectral"
        STAGING_SERVER="AWS Server"
        PRODUCTION_SERVER="AWS Server"
    }
    stages{
        stage('Build'){
            steps{
                echo "fetch the source code from $BUILD_TOOL and compile and package"
            }
        }
        stage('Test'){
            steps{
                echo "unit tests and integration tests using $TESTING_TOOL"
            }
            post{
                success{
                    mail bcc: '', body: 'Testing step was a success', cc: '', from: '', replyTo: '', subject: 'Jenkins Test Results', to: 'dlambrick@deakin.edu.au'                    
                }
                failure{
                    mail bcc: '', body: 'Testing step was a failure. Build terminated', cc: '', from: '', replyTo: '', subject: 'Jenkins Test Results', to: 'dlambrick@deakin.edu.au'                
                }
            }           
        }
        stage('Code Analysis'){
            steps{
                echo "check the quality of the code and analysis using $ANALYSIS_TOOL"
            }
        }     
        stage('Security Scan'){
            steps{
                echo "check for security vulnerabilities using $SECURITY_TOOL"
            }
            post{
                success{
                    mail bcc: '', body: 'Security step was a success', cc: '', from: '', replyTo: '', subject: 'Jenkins Security Results', to: 'dlambrick@deakin.edu.au'
                }
                failure{
                    mail bcc: '', body: 'Security step was a failure. Build terminated', cc: '', from: '', replyTo: '', subject: 'Jenkins Security Results', to: 'dlambrick@deakin.edu.au'                
                }
            }

        }
        stage('Deploy'){
            steps{
                echo "deploy to staging $STAGING_SERVER"
            }
        }
        stage('Integration tests'){
            steps{
                echo "running integration tests on the staging $STAGING_SERVER"
            }
        }
        stage('Deploy to Production'){
            steps{
                echo "deploying to production $PRODUCTION_SERVER"
            }
        }
    }
}